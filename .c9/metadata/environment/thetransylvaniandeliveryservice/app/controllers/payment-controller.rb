{"filter":false,"title":"payment-controller.rb","tooltip":"/thetransylvaniandeliveryservice/app/controllers/payment-controller.rb","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":47,"column":3},"action":"insert","lines":["class PaymentsController < ApplicationController","","def create","    @product = Product.find(params[:product_id])","    @user = current_user","","    token = params[:stripeToken]","","    begin","","      # Amount in cents","      @amount = (@product.price * 100).to_i,","","      # customer = Stripe::Customer.create(","      #   :email => params[:stripeEmail],","      #   :source  => params[:stripeToken]","      # )","","      charge = Stripe::Charge.create(","        # customer: customer.id,","        amount: (@product.price * 100).to_i,","        currency: \"usd\",","        source: token,","        description: \"Magical Unicorn Dust '\"+@product.name+\"'\",","        metadata: {","          'Email-address:' => params[:stripeEmail]","        },","        receipt_email: params[:stripeEmail]","      )","","      if charge.paid","        Order.create(","          product_id: @product.id,","          total: @product.price","        )","        flash[:success] = \"Your payment was processed successfully\"","      end","","    rescue Stripe::CardError => e","      # The card has been declined","      body = e.json_body","      err = body[:error]","      flash[:error] = \"Oops, there was an error processing your payment: #{err[:message]}\"","    end","    redirect_to product_path(@product)","  end","","end"],"id":1}]]},"ace":{"folds":[],"scrolltop":89,"scrollleft":0,"selection":{"start":{"row":47,"column":3},"end":{"row":47,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":45,"state":"start","mode":"ace/mode/ruby"}},"hash":"29ac04742e66b459a368afcd9a17f49960fc0f30","timestamp":1537142364315}